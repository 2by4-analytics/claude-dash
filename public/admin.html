<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MEDIA/DASH â€” Admin</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0f1117;
    --surface: #1a1d27;
    --surface2: #222638;
    --border: #2e3250;
    --accent: #4f6ef7;
    --accent-hover: #3d5ce5;
    --danger: #e05252;
    --danger-hover: #c93f3f;
    --success: #3ecf8e;
    --text: #e2e4f0;
    --muted: #6b7299;
    --label: #9ba3c9;
  }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    font-size: 14px;
    min-height: 100vh;
  }

  /* â”€â”€ Login â”€â”€ */
  #login-screen {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
  }

  .login-box {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 40px;
    width: 360px;
    text-align: center;
  }

  .login-box h1 { font-size: 20px; margin-bottom: 6px; }
  .login-box p { color: var(--muted); margin-bottom: 28px; font-size: 13px; }

  .login-box input {
    width: 100%;
    padding: 10px 14px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-size: 14px;
    margin-bottom: 14px;
    outline: none;
    transition: border-color 0.2s;
  }
  .login-box input:focus { border-color: var(--accent); }

  #login-error { color: var(--danger); font-size: 13px; margin-bottom: 12px; display: none; }

  /* â”€â”€ App shell â”€â”€ */
  #app { display: none; }

  header {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 16px 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  header h1 { font-size: 16px; font-weight: 600; letter-spacing: 0.02em; }
  header span { color: var(--muted); font-size: 13px; }

  .btn-link {
    background: none; border: none; color: var(--muted);
    cursor: pointer; font-size: 13px; text-decoration: underline;
  }
  .btn-link:hover { color: var(--text); }

  main { max-width: 960px; margin: 0 auto; padding: 32px 24px; }

  /* â”€â”€ Toolbar â”€â”€ */
  .toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
  }

  .toolbar h2 { font-size: 18px; font-weight: 600; }

  /* â”€â”€ Buttons â”€â”€ */
  .btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    border-radius: 8px;
    border: none;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.15s, opacity 0.15s;
  }
  .btn:disabled { opacity: 0.5; cursor: not-allowed; }
  .btn-primary { background: var(--accent); color: #fff; }
  .btn-primary:hover:not(:disabled) { background: var(--accent-hover); }
  .btn-danger { background: var(--danger); color: #fff; }
  .btn-danger:hover:not(:disabled) { background: var(--danger-hover); }
  .btn-ghost { background: var(--surface2); color: var(--text); border: 1px solid var(--border); }
  .btn-ghost:hover:not(:disabled) { background: var(--border); }

  /* â”€â”€ Client cards â”€â”€ */
  #client-list { display: flex; flex-direction: column; gap: 12px; }

  .client-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    overflow: hidden;
  }

  .client-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    cursor: pointer;
    user-select: none;
  }

  .client-header:hover { background: var(--surface2); }

  .client-name { font-weight: 600; font-size: 15px; }
  .client-id { color: var(--muted); font-size: 12px; font-family: monospace; margin-top: 2px; }

  .client-actions { display: flex; gap: 8px; align-items: center; }

  .chevron {
    color: var(--muted);
    transition: transform 0.2s;
    font-size: 12px;
    margin-right: 8px;
  }
  .chevron.open { transform: rotate(90deg); }

  .client-body { display: none; padding: 0 20px 20px; border-top: 1px solid var(--border); }
  .client-body.open { display: block; }

  /* â”€â”€ Ad account table â”€â”€ */
  .ad-accounts-label {
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--muted);
    margin: 16px 0 8px;
  }

  table { width: 100%; border-collapse: collapse; font-size: 13px; }
  th { text-align: left; color: var(--muted); font-weight: 500; padding: 6px 10px; border-bottom: 1px solid var(--border); }
  td { padding: 8px 10px; border-bottom: 1px solid var(--border); }
  tr:last-child td { border-bottom: none; }

  .pill {
    display: inline-block;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 2px 8px;
    font-size: 12px;
    font-family: monospace;
  }

  /* â”€â”€ Modal â”€â”€ */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    z-index: 100;
    align-items: flex-start;
    justify-content: center;
    padding: 40px 16px;
    overflow-y: auto;
  }
  .modal-overlay.open { display: flex; }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    width: 100%;
    max-width: 640px;
    padding: 28px;
    position: relative;
  }

  .modal h2 { font-size: 17px; font-weight: 600; margin-bottom: 24px; }

  .form-section-label {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--muted);
    margin: 20px 0 12px;
    padding-bottom: 6px;
    border-bottom: 1px solid var(--border);
  }

  .form-row { margin-bottom: 14px; }
  .form-row label { display: block; font-size: 12px; color: var(--label); margin-bottom: 5px; font-weight: 500; }

  .form-row input {
    width: 100%;
    padding: 9px 12px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 7px;
    color: var(--text);
    font-size: 13px;
    outline: none;
    transition: border-color 0.2s;
  }
  .form-row input:focus { border-color: var(--accent); }
  .form-row input::placeholder { color: var(--muted); }

  /* â”€â”€ Ad account rows in form â”€â”€ */
  #ad-account-rows { display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px; }

  .ad-account-row {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 14px;
    position: relative;
  }

  .ad-account-row .row-grid {
    display: grid;
    grid-template-columns: 1fr 80px 1fr 80px;
    gap: 10px;
    align-items: end;
  }

  .ad-account-row .remove-row {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    font-size: 16px;
    line-height: 1;
    padding: 2px 6px;
    border-radius: 4px;
  }
  .ad-account-row .remove-row:hover { color: var(--danger); background: rgba(224,82,82,0.1); }

  .modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 24px;
    padding-top: 20px;
    border-top: 1px solid var(--border);
  }

  /* â”€â”€ Toast â”€â”€ */
  #toast {
    position: fixed;
    bottom: 28px;
    right: 28px;
    background: var(--success);
    color: #0a2e1e;
    font-weight: 600;
    font-size: 13px;
    padding: 12px 20px;
    border-radius: 8px;
    opacity: 0;
    transform: translateY(8px);
    transition: opacity 0.25s, transform 0.25s;
    z-index: 999;
    pointer-events: none;
  }
  #toast.error { background: var(--danger); color: #fff; }
  #toast.show { opacity: 1; transform: translateY(0); }

  /* â”€â”€ Empty state â”€â”€ */
  .empty {
    text-align: center;
    padding: 60px 20px;
    color: var(--muted);
  }
  .empty .icon { font-size: 36px; margin-bottom: 12px; }
  .empty p { font-size: 14px; }

  .loading { text-align: center; padding: 60px; color: var(--muted); }
</style>
</head>
<body>

<!-- â”€â”€ Login â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="login-screen">
  <div class="login-box">
    <h1>MEDIA/DASH Admin</h1>
    <p>Enter your admin password to continue</p>
    <div id="login-error">Incorrect password</div>
    <input type="password" id="password-input" placeholder="Password" autocomplete="current-password">
    <button class="btn btn-primary" style="width:100%" onclick="doLogin()">Sign In</button>
  </div>
</div>

<!-- â”€â”€ App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="app">
  <header>
    <h1>MEDIA/DASH &mdash; Client Admin</h1>
    <div style="display:flex;align-items:center;gap:16px">
      <a href="/" style="color:var(--muted);font-size:13px;text-decoration:none;">â† Dashboard</a>
      <button class="btn-link" onclick="doLogout()">Sign out</button>
    </div>
  </header>

  <main>
    <div class="toolbar">
      <h2>Clients</h2>
      <button class="btn btn-primary" onclick="openModal()">ï¼‹ Add Client</button>
    </div>

    <div id="client-list"><div class="loading">Loadingâ€¦</div></div>
  </main>
</div>

<!-- â”€â”€ Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="modal-overlay" id="modal">
  <div class="modal">
    <h2 id="modal-title">Add Client</h2>

    <div class="form-section-label">Client Info</div>
    <div class="form-row">
      <label>Client Name</label>
      <input type="text" id="f-name" placeholder="e.g. Eric">
    </div>

    <div class="form-section-label">Checkout Champ Credentials</div>
    <div class="form-row">
      <label>COC Login ID</label>
      <input type="text" id="f-cocLoginId" placeholder="COC login ID" autocomplete="off">
    </div>
    <div class="form-row">
      <label>COC Password</label>
      <input type="password" id="f-cocPassword" placeholder="COC password" autocomplete="new-password">
    </div>

    <div class="form-section-label">Facebook</div>
    <div class="form-row">
      <label>FB Access Token</label>
      <input type="password" id="f-fbAccessToken" placeholder="Facebook Marketing API token" autocomplete="off">
    </div>

    <div class="form-section-label">Ad Accounts</div>
    <div id="ad-account-rows"></div>
    <button class="btn btn-ghost" style="width:100%;margin-bottom:4px" onclick="addAdAccountRow()">ï¼‹ Add Ad Account</button>

    <div id="modal-error" style="color:var(--danger);font-size:13px;margin-top:12px;display:none"></div>

    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" id="save-btn" onclick="saveClient()">Save Client</button>
    </div>
  </div>
</div>

<!-- â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="toast"></div>

<script>
// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let PASSWORD = '';
let editingClientId = null;
let clients = [];

// â”€â”€ Auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doLogin() {
  const pw = document.getElementById('password-input').value;
  if (!pw) return;
  PASSWORD = pw;
  loadClients();
}

document.getElementById('password-input').addEventListener('keydown', e => {
  if (e.key === 'Enter') doLogin();
});

function doLogout() {
  PASSWORD = '';
  document.getElementById('login-screen').style.display = 'flex';
  document.getElementById('app').style.display = 'none';
}

// â”€â”€ API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function api(method, path, body) {
  const opts = {
    method,
    headers: {
      'Content-Type': 'application/json',
      'x-admin-password': PASSWORD,
    },
  };
  if (body) opts.body = JSON.stringify(body);
  const r = await fetch('/api/admin' + path, opts);
  const data = await r.json();
  if (!r.ok) throw new Error(data.error || 'Request failed');
  return data;
}

// â”€â”€ Load clients â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadClients() {
  try {
    const data = await api('GET', '/clients');
    clients = data.clients;
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('app').style.display = 'block';
    document.getElementById('login-error').style.display = 'none';
    renderClients();
  } catch (err) {
    if (err.message === 'Unauthorized') {
      document.getElementById('login-error').style.display = 'block';
      PASSWORD = '';
    } else {
      toast('Error: ' + err.message, true);
    }
  }
}

// â”€â”€ Render clients â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderClients() {
  const el = document.getElementById('client-list');

  if (!clients.length) {
    el.innerHTML = `<div class="empty"><div class="icon">ğŸ‘¤</div><p>No clients yet. Add your first one.</p></div>`;
    return;
  }

  el.innerHTML = clients.map((c, i) => `
    <div class="client-card">
      <div class="client-header" onclick="toggleCard(${i})">
        <div>
          <div class="client-name">${esc(c.name)}</div>
          <div class="client-id">${esc(c.id)}</div>
        </div>
        <div class="client-actions">
          <button class="btn btn-ghost" onclick="event.stopPropagation(); openModal('${c.id}')">Edit</button>
          <button class="btn btn-danger" onclick="event.stopPropagation(); deleteClient('${c.id}', '${esc(c.name)}')">Delete</button>
          <span class="chevron" id="chevron-${i}">â–¶</span>
        </div>
      </div>
      <div class="client-body" id="body-${i}">
        <div class="ad-accounts-label">Ad Accounts (${c.adAccounts.length})</div>
        ${c.adAccounts.length ? `
          <table>
            <thead>
              <tr>
                <th>COC Campaign</th>
                <th>COC Campaign ID</th>
                <th>FB Ad Account ID</th>
                <th>CPP Target</th>
              </tr>
            </thead>
            <tbody>
              ${c.adAccounts.map(a => `
                <tr>
                  <td>${esc(a.cocCampaignName)}</td>
                  <td><span class="pill">${a.cocCampaignId}</span></td>
                  <td><span class="pill">${esc(a.fbAdAccountId)}</span></td>
                  <td>${a.cppTarget ? '$' + a.cppTarget : 'â€”'}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        ` : '<p style="color:var(--muted);font-size:13px;padding:12px 0">No ad accounts configured</p>'}
      </div>
    </div>
  `).join('');
}

function toggleCard(i) {
  const body = document.getElementById('body-' + i);
  const chev = document.getElementById('chevron-' + i);
  body.classList.toggle('open');
  chev.classList.toggle('open');
}

// â”€â”€ Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(clientId) {
  editingClientId = clientId || null;
  const modal = document.getElementById('modal');
  document.getElementById('modal-title').textContent = editingClientId ? 'Edit Client' : 'Add Client';
  document.getElementById('modal-error').style.display = 'none';

  // Reset fields
  ['f-name','f-cocLoginId','f-cocPassword','f-fbAccessToken'].forEach(id => {
    document.getElementById(id).value = '';
  });
  document.getElementById('ad-account-rows').innerHTML = '';

  if (editingClientId) {
    const c = clients.find(x => x.id === clientId);
    if (c) {
      document.getElementById('f-name').value = c.name;
      document.getElementById('f-cocLoginId').value = c.cocLoginId;
      document.getElementById('f-cocPassword').value = c.cocPassword;
      document.getElementById('f-fbAccessToken').value = c.fbAccessToken;
      (c.adAccounts || []).forEach(a => addAdAccountRow(a));
    }
  } else {
    addAdAccountRow();
  }

  modal.classList.add('open');
}

function closeModal() {
  document.getElementById('modal').classList.remove('open');
}

// Close on overlay click
document.getElementById('modal').addEventListener('click', e => {
  if (e.target === e.currentTarget) closeModal();
});

// â”€â”€ Ad account rows â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addAdAccountRow(data = {}) {
  const container = document.getElementById('ad-account-rows');
  const div = document.createElement('div');
  div.className = 'ad-account-row';
  div.innerHTML = `
    <button class="remove-row" onclick="this.parentElement.remove()" title="Remove">âœ•</button>
    <div class="row-grid">
      <div>
        <label style="display:block;font-size:12px;color:var(--label);margin-bottom:4px;font-weight:500">FB Ad Account ID</label>
        <input type="text" class="aa-fb" placeholder="act_XXXXXXXXXX" value="${esc(data.fbAdAccountId||'')}">
      </div>
      <div>
        <label style="display:block;font-size:12px;color:var(--label);margin-bottom:4px;font-weight:500">COC Campaign ID</label>
        <input type="number" class="aa-cocId" placeholder="1" value="${data.cocCampaignId||''}">
      </div>
      <div>
        <label style="display:block;font-size:12px;color:var(--label);margin-bottom:4px;font-weight:500">COC Campaign Name</label>
        <input type="text" class="aa-cocName" placeholder="e.g. Plant" value="${esc(data.cocCampaignName||'')}">
      </div>
      <div>
        <label style="display:block;font-size:12px;color:var(--label);margin-bottom:4px;font-weight:500">CPP Target</label>
        <input type="number" class="aa-cpp" placeholder="Optional" step="0.01" value="${data.cppTarget||''}">
      </div>
    </div>
  `;

  // Style the inner inputs to match
  div.querySelectorAll('input').forEach(inp => {
    inp.style.cssText = 'width:100%;padding:8px 10px;background:var(--surface);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:13px;outline:none';
    inp.addEventListener('focus', () => inp.style.borderColor = 'var(--accent)');
    inp.addEventListener('blur', () => inp.style.borderColor = 'var(--border)');
  });

  container.appendChild(div);
}

function collectAdAccounts() {
  return Array.from(document.querySelectorAll('.ad-account-row')).map(row => ({
    fbAdAccountId: row.querySelector('.aa-fb').value.trim(),
    cocCampaignId: row.querySelector('.aa-cocId').value,
    cocCampaignName: row.querySelector('.aa-cocName').value.trim(),
    cppTarget: row.querySelector('.aa-cpp').value || null,
  }));
}

// â”€â”€ Save â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function saveClient() {
  const errEl = document.getElementById('modal-error');
  errEl.style.display = 'none';

  const payload = {
    name: document.getElementById('f-name').value.trim(),
    cocLoginId: document.getElementById('f-cocLoginId').value.trim(),
    cocPassword: document.getElementById('f-cocPassword').value.trim(),
    fbAccessToken: document.getElementById('f-fbAccessToken').value.trim(),
    adAccounts: collectAdAccounts(),
  };

  if (!payload.name) { showModalError('Client name is required'); return; }
  if (!payload.cocLoginId) { showModalError('COC Login ID is required'); return; }
  if (!payload.cocPassword) { showModalError('COC Password is required'); return; }
  if (!payload.fbAccessToken) { showModalError('FB Access Token is required'); return; }

  for (const [i, aa] of payload.adAccounts.entries()) {
    if (!aa.fbAdAccountId) { showModalError(`Ad account ${i+1}: FB Ad Account ID is required`); return; }
    if (!aa.cocCampaignId) { showModalError(`Ad account ${i+1}: COC Campaign ID is required`); return; }
    if (!aa.cocCampaignName) { showModalError(`Ad account ${i+1}: COC Campaign Name is required`); return; }
  }

  const btn = document.getElementById('save-btn');
  btn.disabled = true;
  btn.textContent = 'Savingâ€¦';

  try {
    if (editingClientId) {
      await api('PUT', '/clients/' + editingClientId, payload);
    } else {
      await api('POST', '/clients', payload);
    }
    closeModal();
    await loadClients();
    toast(editingClientId ? 'Client updated âœ“' : 'Client added âœ“');
  } catch (err) {
    showModalError(err.message);
  } finally {
    btn.disabled = false;
    btn.textContent = 'Save Client';
  }
}

function showModalError(msg) {
  const el = document.getElementById('modal-error');
  el.textContent = msg;
  el.style.display = 'block';
}

// â”€â”€ Delete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function deleteClient(id, name) {
  if (!confirm(`Delete client "${name}"? This cannot be undone.`)) return;
  try {
    await api('DELETE', '/clients/' + id);
    await loadClients();
    toast('Client deleted');
  } catch (err) {
    toast('Error: ' + err.message, true);
  }
}

// â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let toastTimer;
function toast(msg, isError = false) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.className = isError ? 'error show' : 'show';
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.classList.remove('show'), 3000);
}

// â”€â”€ Escape html â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function esc(str) {
  return String(str || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
</script>
</body>
</html>
